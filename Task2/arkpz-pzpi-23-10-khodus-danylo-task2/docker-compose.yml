version: '3.8'

services:
  # БЭКЕНД (C#)
  robdeliveryapi:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: robdelivery-api
    ports:
      - "5102:8080"
      - "7102:8081"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://+:8080
      # Настройки JWT (можно вынести в .env, но оставляем как было)
      - Jwt__Secret=${JWT_SECRET:-YourSuperSecretKeyThatIsAtLeast32CharactersLong!}
      - Jwt__Issuer=${JWT_ISSUER:-RobDeliveryAPI}
      - Jwt__Audience=${JWT_AUDIENCE:-RobDeliveryAPI}
      - Jwt__ExpirationInHours=${JWT_EXPIRATION_HOURS:-24}
    volumes:
      - robdelivery-db:/app/Infrastructure/DB_Storage
      - robdelivery-uploads:/app/Uploads
      - robdelivery-backups:/app/Backups
    restart: unless-stopped
    networks:
      - robdelivery-network

  # ФРОНТЕНД (React/Vite)
  robdeliveryweb:
    build:
      context: ./robdelivery-web
      dockerfile: Dockerfile
    container_name: robdelivery-web
    ports:
      - "80:80"
    depends_on:
      - robdeliveryapi
    networks:
      - robdelivery-network

volumes:
  robdelivery-db:
    driver: local
  robdelivery-uploads:
    driver: local
  robdelivery-backups:
    driver: local

networks:
  robdelivery-network:
    driver: bridge