# Wokwi File Uploader

Консольное приложение для автоматизации загрузки файлов в проекты Wokwi.

## Быстрый старт

```bash
# 1. Перейдите в папку проекта
cd WokwiLoader

# 2. Запустите приложение
dotnet run

# 3. При первом запуске введите данные проекта:
#    - Project ID (из URL проекта Wokwi)
#    - Название проекта
#    - Cookie для аутентификации

# 4. Укажите путь к папке с файлами для загрузки

# Готово! Файлы загружены на Wokwi
```

**Для Windows:** Можно просто запустить `run.bat` из корня проекта.

## Возможности

- ✅ Интерактивное создание конфигурации при первом запуске
- ✅ Сохранение пути к папке в конфиге (не нужно вводить каждый раз)
- ✅ Автоматическое удаление всех существующих файлов из проекта
- ✅ Рекурсивная загрузка файлов из указанной папки
- ✅ Поддержка бинарных файлов (автоматическое кодирование в Base64)
- ✅ Сохранение структуры папок
- ✅ Поддержка аутентификации через Cookie
- ✅ Пересоздание конфигурации через параметр командной строки
- ✅ Приложение не закрывается автоматически (ждет нажатия клавиши)

## Установка и запуск

### 1. Создайте config.json

**Автоматический способ (рекомендуется):**

Просто запустите приложение - оно само предложит создать конфигурацию:

```bash
dotnet run
```

Приложение задаст следующие вопросы:
1. Project ID (найдите в URL вашего проекта)
2. Название проекта
3. Видимость проекта (публичный/скрытый)
4. Cookie для аутентификации
5. Путь к папке с файлами (опционально, можно оставить пустым)

**Ручной способ:**

Скопируйте `config.example.json` в `config.json` и заполните:

```json
{
  "projectId": "ваш_project_id",
  "projectName": "Название проекта",
  "unlisted": false,
  "cookie": "ваша_cookie_из_браузера",
  "folderPath": "E:\\path\\to\\your\\project\\folder"
}
```

**Примечание:** Если указать `folderPath` в конфиге, приложение будет использовать этот путь по умолчанию, спрашивая подтверждение при каждом запуске.

### 2. Получение Cookie из браузера

**Для Chrome/Edge:**
1. Откройте https://wokwi.com и авторизуйтесь
2. Нажмите F12 (DevTools)
3. Перейдите во вкладку "Network" (Сеть)
4. Обновите страницу (F5)
5. Найдите любой запрос к wokwi.com
6. Во вкладке "Headers" найдите "Request Headers"
7. Скопируйте значение поля "Cookie"

**Для Firefox:**
1. Откройте https://wokwi.com и авторизуйтесь
2. Нажмите F12 (DevTools)
3. Перейдите во вкладку "Сеть" (Network)
4. Обновите страницу (F5)
5. Выберите любой запрос к wokwi.com
6. В правой панели найдите "Заголовки запроса"
7. Скопируйте значение "Cookie"

### 3. Получение Project ID

Project ID можно найти в URL вашего проекта Wokwi:
```
https://wokwi.com/projects/449518275595938817
                          ^^^^^^^^^^^^^^^^^^
                          это ваш Project ID
```

### 4. Запуск приложения

```bash
cd WokwiLoader
dotnet run
```

При запуске приложение попросит указать путь к папке с файлами, которые нужно загрузить.

**Дополнительные команды:**

```bash
# Пересоздать конфигурацию
dotnet run -- --reset-config

# Короткая версия
dotnet run -- -r
```

## Поддерживаемые форматы файлов

### Текстовые файлы
Загружаются как есть (UTF-8):
- .ino, .cpp, .c, .h, .hpp
- .json, .toml, .txt, .md
- .js, .ts, .py и другие

### Бинарные файлы
Автоматически кодируются в Base64:
- .bin, .hex
- .png, .jpg, .jpeg, .gif, .bmp, .ico
- .wasm

## Примеры использования

### Загрузка простого проекта

```
E:\Dodikuser\MyArduinoProject\
├── sketch.ino
├── diagram.json
└── wokwi.toml
```

Запустите приложение и укажите путь: `E:\Dodikuser\MyArduinoProject`

### Загрузка проекта со вложенными папками

```
E:\Dodikuser\ComplexProject\
├── main.ino
├── diagram.json
├── lib\
│   ├── helper.h
│   └── helper.cpp
└── data\
    ├── image.png
    └── config.json
```

Все файлы будут загружены с сохранением структуры:
- `main.ino`
- `diagram.json`
- `lib/helper.h`
- `lib/helper.cpp`
- `data/image.png`
- `data/config.json`

## Как это работает

1. **Очистка проекта**: Отправляется POST запрос с пустым массивом файлов
   ```json
   {
     "files": [],
     "id": "project_id",
     "name": "project_name",
     "unlisted": false
   }
   ```

2. **Чтение файлов**: Рекурсивно читаются все файлы из указанной папки

3. **Загрузка**: Отправляется POST запрос с массивом файлов
   ```json
   {
     "files": [
       {
         "name": "sketch.ino",
         "content": "содержимое файла"
       },
       {
         "name": "data/image.png",
         "content": "base64_encoded_content"
       }
     ],
     "id": "project_id",
     "name": "project_name",
     "unlisted": false
   }
   ```

## Работа с путем к папке

### Автоматическое использование сохраненного пути

Если в конфиге указан `folderPath` и папка существует, приложение спросит:
```
Используется папка из конфига: E:\Projects\MyArduinoProject
Использовать эту папку? (Y/n):
```

- Нажмите **Enter** или **Y** для использования
- Введите **n** для выбора другой папки

### Сохранение нового пути

При выборе новой папки приложение предложит:
```
Сохранить этот путь в конфиге для следующих запусков? (Y/n):
```

- Нажмите **Enter** или **Y** для сохранения
- Введите **n** если не хотите сохранять

## Troubleshooting

### Ошибка: "Cookie не указана"
Убедитесь, что вы скопировали Cookie из браузера и вставили в `config.json`

### Ошибка 401 Unauthorized
Ваша Cookie устарела. Получите новую из браузера после повторной авторизации.

### Ошибка 404 Not Found
Проверьте правильность Project ID в конфигурации.

### Ошибка при загрузке больших файлов
Wokwi может иметь ограничения на размер файлов. Попробуйте загрузить файлы меньшего размера.

### Приложение сразу закрывается
Теперь приложение всегда ждет нажатия клавиши перед выходом. Если закрывается моментально, возможно, вы используете старую версию - пересоберите проект.

## Технические детали

- **API Endpoint**: `https://wokwi.com/api/projects/save`
- **HTTP Method**: POST
- **Content-Type**: application/json
- **Аутентификация**: Cookie-based

## Лицензия

MIT
